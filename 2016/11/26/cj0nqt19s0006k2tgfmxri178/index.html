<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>向Nginx添加SSL证书 | Moren&#39;s</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="http://morensblog-static.tengtengtengteng.com/static/img/favicon.png">
    <link rel="stylesheet" href="/blog/css/style.css">
</head>

<body>
<nav class="navbar">
    <div class="layout">
        <div class="content ">
            
            
            <a href="/blog/.">Home</a>
            
            
            
            <a href="/blog/archives">Archive</a>
            
            
            
            <a href="http://yangteng.me">About</a>
            
            
        </div>
    </div>
</nav>

<main class="post">
    <article>
    <h1 class="article-title">
        <a href="/blog/2016/11/26/cj0nqt19s0006k2tgfmxri178/">向Nginx添加SSL证书</a>
    </h1>

    <section class="article-meta">
        <p class="article-date">November 26 2016</p>
    </section>

    <section class="article-entry">
        <p>HTTPS，是以安全为目标的 HTTP 通道，用以提供加密通讯以及对网络服务器身份的鉴定，被广泛用于对互联网上的隐秘通话的保护上，比如网上交易环节。现在已有越来越多的网站使用HTTPS。</p>
<h3 id="获取SSL证书"><a href="#获取SSL证书" class="headerlink" title="获取SSL证书"></a>获取SSL证书</h3><p>要在你的域名上使用HTTPS，首先你要申请SSL证书。目前SSL证书分为三类：</p>
<ul>
<li>域名型SSL证书（DV SSL）<blockquote>
<p>信任等级普通，只需验证网站的真实性便可颁发证书保护网站。(一般个人网站、中小型企业或者内容展示型的网站使用此类证书就可以了。)</p>
</blockquote>
</li>
<li>企业型SSL证书（OV SSL） <blockquote>
<p>信任等级强，须要验证企业的身份，审核严格，安全性更高；</p>
</blockquote>
</li>
<li>增强型SSL证书（EV SSL）<blockquote>
<p>信任等级最高，一般用于银行证券等金融机构，审核严格，安全性最高，同时可以激活网址栏绿色企业信息。</p>
</blockquote>
</li>
</ul>
<blockquote>
<p><img src="http://morensblog-static.tengtengtengteng.com/img/post/20161126nginx-https-settings-1.png" alt=""><br><img src="http://morensblog-static.tengtengtengteng.com/img/post/20161126nginx-https-settings-2.png" alt=""><br>使用DV和OV证书与使用EV证书，在浏览器中的显示效果</p>
</blockquote>
<p>一般来说，想要获取一个SSL证书，需要向签发机构支付一笔认证费用。但是腾讯云和阿里云用户都可以免费申请认证市场为一年的DV证书，他们的CA机构都是Symantec，而且认证方式也十分简单快捷，只需要向你的域名添加一个CNAME记录即可。</p>
<p>在你的证书认证通过后，你就可以下载到你域名的证书了。</p>
<blockquote>
<p><img src="http://morensblog-static.tengtengtengteng.com/img/post/20161126nginx-https-settings-3.png" alt=""><br>下载的证书和秘钥文件</p>
</blockquote>
<h3 id="把证书部署到Nginx中"><a href="#把证书部署到Nginx中" class="headerlink" title="把证书部署到Nginx中"></a>把证书部署到Nginx中</h3><p>首先打开你的Nginx配置文件夹，例如我的文件夹是<code>/etc/nginx</code>。使用<code>ls</code>命令，你可以看到文件夹中的所有文件。<br><img src="http://morensblog-static.tengtengtengteng.com/img/post/20161126nginx-https-settings-4.png" alt=""><br>然后使用编辑器打开默认配置文件<code>nginx.conf</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo nano nginx.conf</div></pre></td></tr></table></figure>
<p>一般来说，在<code>http</code>项的配置中，你会看到下面这一句话<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">http&#123;</div><div class="line">    <span class="comment"># something other</span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">    <span class="comment"># 一般来说你会看到下面这句话</span></div><div class="line">    include /etc/nginx/conf.d/*.conf</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果有的话，就可以直接退出编辑器；如果没有的话，就手动加上并保存，然后退出编辑器。<br>然后我们进入到<code>conf.d</code>这个文件夹中，新建一个文件夹来保存我们的证书和秘钥：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo mkdir crt</div></pre></td></tr></table></figure></p>
<p>我们可以使用<code>ls</code>命令来查看是否创建成功。创建成功后，就把刚才下载的证书和秘钥放到<code>crt</code>的文件夹中。<del>这里为了偷懒，我直接把证书和秘钥扔到了COS中，然后用<code>wget</code>命令下载。</del><br>完事之后，我们在刚才的<code>conf.d</code>文件夹中新建一个配置文件，例如<code>www.conf</code>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo nano www.conf</div></pre></td></tr></table></figure></p>
<p>接着向配置文件中输入网站的配置项，我们以<code>tengtengtengteng.com</code>为例，输入：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen 443; <span class="comment"># 监听443端口</span></div><div class="line">        server_name www.tengtengtengteng.com; <span class="comment">#填写绑定证书的域名</span></div><div class="line">        ssl on; <span class="comment"># 设置SSL为开启</span></div><div class="line">        ssl_certificate /etc/nginx/conf.d/crt/1_www.tengtengtengteng.com_bundle.crt; <span class="comment"># 刚才保存的证书文件</span></div><div class="line">        ssl_certificate_key /etc/nginx/conf.d/crt/2_www.tengtengtengteng.com.key; <span class="comment"># 刚才保存的秘钥文件</span></div><div class="line">        ssl_session_timeout 5m;</div><div class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; <span class="comment"># 按照这个协议配置</span></div><div class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;<span class="comment"># 按照这个套件配置</span></div><div class="line">        ssl_prefer_server_ciphers on;</div><div class="line">        location / &#123;</div><div class="line">            <span class="comment"># 输入你站点定向内容</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>保存，然后重启Nginx服务器<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo service nginx restart</div></pre></td></tr></table></figure></p>
<p>如果重启命令回复的状态是<code>[OK]</code>就证明你的配置没有问题了</p>
<h3 id="设置HTTP请求自动跳转到HTTPS"><a href="#设置HTTP请求自动跳转到HTTPS" class="headerlink" title="设置HTTP请求自动跳转到HTTPS"></a>设置HTTP请求自动跳转到HTTPS</h3><p>如果要让网站强制使用HTTPS的话，有不少种方法，最简单方便的就是直接在Nginx的配置文件中把80端口的请求指向443端口中。我们只需要在刚才的<code>www.conf</code>文件中加入这一段：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">server&#123;</div><div class="line">	listen 443;</div><div class="line">	<span class="comment"># something...</span></div><div class="line">	<span class="comment"># 这是刚才我们加的那段</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment"># 新加入下面这一段</span></div><div class="line">server &#123;</div><div class="line">    listen 80;</div><div class="line">    server_name www.tengtengtengteng.com;</div><div class="line">    rewrite ^(.*) https://<span class="variable">$host</span><span class="variable">$1</span> permanent;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>同样，保存后重启Nginx服务器即可。</p>

    </section>
</article>

</main>
<footer class="footer">
    <p>Powered by Moren YANG&nbsp;&nbsp;-&nbsp;&nbsp;ackn. <a href="https://hexo.io"> Hexo </a></p>
</footer>

</body>
</html>
