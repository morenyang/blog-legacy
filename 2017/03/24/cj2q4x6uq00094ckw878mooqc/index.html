<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>一不小心POST了一个Payload | Moren&#39;s</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="http://yangteng.me/static/favicon.png">
    <link rel="stylesheet" href="/blog/css/style.css">
</head>

<body>
<nav class="navbar">
    <div class="layout">
        <div class="content ">
            
            
            <a href="/blog/.">Home</a>
            
            
            
            <a href="/blog/archives">Archive</a>
            
            
            
            <a href="http://yangteng.me">About</a>
            
            
        </div>
    </div>
</nav>

<main class="post">
    <article>
    <h1 class="article-title">
        <a href="/blog/2017/03/24/cj2q4x6uq00094ckw878mooqc/">一不小心POST了一个Payload</a>
    </h1>

    <section class="article-meta">
        <p class="article-date">March 24 2017</p>
    </section>

    <section class="article-entry">
        <p>事情是这样的，那天我和同学正在测试接口，然后我写的方法是这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> axois <span class="keyword">from</span> <span class="string">'axios'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">    UpdateImageUrl(data)&#123;</div><div class="line">        <span class="keyword">let</span> url = <span class="string">'/api/image/updateUrl?id='</span> + data.id;</div><div class="line">        <span class="keyword">return</span> axios.post(url, data);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然而同学却一直很坚定的告诉我后台没有收到数据，于是我打开了开发工具的Network，原本以为传错了什么参数，<strong>然而却发现并没有什么问题</strong></p>
<p><img src="http://morensblog-static.tengtengtengteng.com/img/post/20170324post-request-payload-1.png" alt=""></p>
<p>仔细对了一下发出去的内容，确实没什么错，但是感觉它和平时我们POST数据的样子确实有一些区别。直觉告诉我问题一定是出在这里。</p>
<p>我们平时使用POST请求上传表单时，发出去的内容，抬头因该是<code>Form Data</code>，它的请求格式应该是类似于GET请求的URL格式，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">name=xiaoming&amp;age=18</div></pre></td></tr></table></figure>
<p>然而在这里，抬头却变成了<code>Request Payload</code>。Google了一下Payload， 大意是POST请求时，所携带的有效数据。因为我们没有在指定XHR请求的<code>Content-Type</code>为<code>application/x-www-form-urlencode</code>，因此在发送XHR请求时不会对其中的内容进行处理成表单数据，而是直接把整个JSON对象传了上去。</p>
<p>所以有什么好的解决方法呢</p>
<p>一种是在http请求的头部指定<code>Content-Type</code>，例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">    <span class="keyword">let</span> url = <span class="string">'/api/fakeapi'</span>;</div><div class="line">    <span class="keyword">return</span> axios.post(url, data, &#123;<span class="attr">headers</span>: &#123;<span class="string">`Content-Type`</span>: <span class="string">`application/x-www-form-urlencode`</span>&#125;&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>或者是在发出请求前将JSON数据改为urlencode格式，例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></div><div class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'qs'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">    <span class="keyword">let</span> url = <span class="string">'/api/fakeapi'</span>;</div><div class="line">    <span class="keyword">return</span> axios.post(url, qs.stringify(data));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>嗯就说这么多吧。</p>

    </section>
</article>

</main>
<footer class="footer">
    <p>Powered by Moren YANG&nbsp;&nbsp;-&nbsp;&nbsp;ackn. <a href="https://hexo.io"> Hexo </a></p>
</footer>

</body>
</html>
